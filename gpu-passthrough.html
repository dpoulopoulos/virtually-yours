<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>GPU Passthrough &mdash; Virtually Yours 0.0.1 documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="_static/jquery.js?v=5d32c60e"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="_static/documentation_options.js?v=d45e8c67"></script>
        <script src="_static/doctools.js?v=9a2dae69"></script>
        <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
        <script src="_static/clipboard.min.js?v=a7894cd8"></script>
        <script src="_static/copybutton.js?v=6dbb43f8"></script>
        <script src="https://kit.fontawesome.com/a5cfa99c7d.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="Rename a VM" href="rename-vm.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            Virtually Yours
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="debian.html">Create a Debian VM</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Administration Guides:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="install.html">Install QEMU and libvirt on Debian</a></li>
<li class="toctree-l1"><a class="reference internal" href="rename-vm.html">Rename a VM</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">GPU Passthrough</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#what-you-ll-need">What you’ll need</a></li>
<li class="toctree-l2"><a class="reference internal" href="#step-1-set-your-primary-display-for-the-host">Step 1: Set your Primary Display for the Host</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1">What you’ll need</a></li>
<li class="toctree-l3"><a class="reference internal" href="#procedure">Procedure</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#step-2-enable-gpu-passthrough">Step 2: Enable GPU Passthrough</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id2">What you’ll need</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id3">Procedure</a></li>
<li class="toctree-l3"><a class="reference internal" href="#verify">Verify</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#step-3-pass-the-gpu-to-the-vm">Step 3: Pass the GPU to the VM</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id4">What you’ll need</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id5">Procedure</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id6">Verify</a></li>
</ul>
</li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Virtually Yours</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">GPU Passthrough</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/gpu-passthrough.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="gpu-passthrough">
<h1>GPU Passthrough<a class="headerlink" href="#gpu-passthrough" title="Link to this heading"></a></h1>
<p>This guide walks you through the process of passing a GPU through to a Virtual Machine (VM), an
essential step for setting up a VM to function as a Machine Learning (ML) server.</p>
<section id="what-you-ll-need">
<h2>What you’ll need<a class="headerlink" href="#what-you-ll-need" title="Link to this heading"></a></h2>
<p>Το complete this guide, you will need the following:</p>
<ul class="simple">
<li><p>A Debian-based system.</p></li>
<li><p>Root access to the host machine.</p></li>
<li><p>A working <a class="reference internal" href="#qemu-kvm"><span class="xref myst">QEMU/KVM installation</span></a>.</p></li>
<li><p>A <a class="reference internal" href="debian.html"><span class="doc std std-doc">running VM</span></a>.</p></li>
<li><p>Access to the BIOS settings of the host machine.</p></li>
<li><p>A dedicated GPU that is not being used by the host (e.g., a dedicated NVIDIA GPU).</p></li>
</ul>
</section>
<section id="step-1-set-your-primary-display-for-the-host">
<h2>Step 1: Set your Primary Display for the Host<a class="headerlink" href="#step-1-set-your-primary-display-for-the-host" title="Link to this heading"></a></h2>
<p>This step is essential for switching the primary display to the integrated GPU, thereby leaving the
dedicated GPU available for use by the VM.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If you are running a Linux server without a GUI, you can skip this step.</p>
</div>
<section id="id1">
<h3>What you’ll need<a class="headerlink" href="#id1" title="Link to this heading"></a></h3>
<p>To complete this step, you will need:</p>
<ul class="simple">
<li><p>Root access to the host machine.</p></li>
<li><p>Access to the BIOS settings of the host machine.</p></li>
</ul>
</section>
<section id="procedure">
<h3>Procedure<a class="headerlink" href="#procedure" title="Link to this heading"></a></h3>
<p>Follow the steps below to set the primary display for the host machine. The steps configure the X
server to use the integrated GPU and set the primary display in the BIOS settings.</p>
<ol class="arabic">
<li><p>Get the BusID of the integrated GPU by running the following command:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go"> user:~/virtml$ lspci | grep VGA</span>
<span class="go"> 00:02.0 VGA compatible controller: Intel Corporation Raptor Lake-S GT1 [UHD Graphics 770] (rev 04)</span>
<span class="go"> 01:00.0 VGA compatible controller: NVIDIA Corporation GA106 [GeForce RTX 3060 Lite Hash Rate] (rev a1)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>In this example, the BusID of the integrated GPU is <code class="docutils literal notranslate"><span class="pre">PCI:0:2:0</span></code>.</p>
</div>
</li>
<li><p>Export the BusID in an environment variable:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">user:~/virtml$ </span><span class="nb">export</span><span class="w"> </span><span class="nv">PCI_BUS_ID</span><span class="o">=</span><span class="s2">&quot;PCI:0:2:0&quot;</span>
</pre></div>
</div>
</li>
<li><p>Create the configuration file for the X server, using the provided template:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">user:~/virtml$ </span>j2<span class="w"> </span>templates/intel.conf.j2<span class="w"> </span>&gt;<span class="w"> </span>config/intel.conf
</pre></div>
</div>
</li>
<li><p>Copy the configuration file to the X server configuration directory:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">user:~/virtml$ </span>sudo<span class="w"> </span>cp<span class="w"> </span>config/intel.conf<span class="w"> </span>/etc/X11/xorg.conf.d/20-intel.conf
</pre></div>
</div>
</li>
<li><p>Change the ownership and the group of the configuration file to <code class="docutils literal notranslate"><span class="pre">root</span></code>:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">user:~/virtml$ </span>sudo<span class="w"> </span>chown<span class="w"> </span>root:root<span class="w"> </span>/etc/X11/xorg.conf.d/20-intel.conf
</pre></div>
</div>
</li>
<li><p>Boot to UEFI/BIOS settings, and set the primary display to the integrated GPU. Look under
“Advanced” settings, for an option similar to “Primary Display”. Set it to “Auto” and connect the
monitor directly to the motherboard. Alternativelly, set it to “CPU” or “iGPU” if available.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">user:~/virtml$ </span>sudo<span class="w"> </span>systemctl<span class="w"> </span>reboot<span class="w"> </span>--firmware-setup
</pre></div>
</div>
</li>
</ol>
</section>
</section>
<section id="step-2-enable-gpu-passthrough">
<h2>Step 2: Enable GPU Passthrough<a class="headerlink" href="#step-2-enable-gpu-passthrough" title="Link to this heading"></a></h2>
<p>In this section, you will bind the GPU to the VFIO driver and prevent the Linux Kernel from loading
the NVIDIA driver during boot.</p>
<section id="id2">
<h3>What you’ll need<a class="headerlink" href="#id2" title="Link to this heading"></a></h3>
<p>To complete this step, you will need:</p>
<ul class="simple">
<li><p>Root access to the host machine.</p></li>
<li><p>A dedicated GPU that is not being used by the host.</p></li>
</ul>
</section>
<section id="id3">
<h3>Procedure<a class="headerlink" href="#id3" title="Link to this heading"></a></h3>
<p>Follow the steps below to bind the GPU to the VFIO driver and prevent the Linux Kernel from loading
the NVIDIA driver during boot.</p>
<ol class="arabic">
<li><p>Change to root user:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">user:~/virtml$ </span>sudo<span class="w"> </span>su<span class="w"> </span>-
<span class="gp">root:~#</span>
</pre></div>
</div>
</li>
<li><p>Get the PCIe ID of the GPU:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">root:~# </span>lspci<span class="w"> </span>-nn<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-i<span class="w"> </span>nvidia
<span class="go">01:00.0 VGA compatible controller [0300]: NVIDIA Corporation GA106 [GeForce RTX 3060 Lite Hash Rate] [10de:2504] (rev a1)</span>
<span class="go">01:00.1 Audio device [0403]: NVIDIA Corporation GA106 High Definition Audio Controller [10de:228e] (rev a1)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The PCIe ID of the VGA controller is <code class="docutils literal notranslate"><span class="pre">10de:2504</span></code> and the Audio device is <code class="docutils literal notranslate"><span class="pre">10de:228e</span></code>. Take a
note of these IDs. You will need them later.</p>
</div>
</li>
<li><p>Change the <code class="docutils literal notranslate"><span class="pre">GRUB_CMDLINE_LINUX_DEFAULT</span></code> variable in the <code class="docutils literal notranslate"><span class="pre">/etc/default/grub</span></code> file to include the
following options:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">intel_iommu=on</span></code>: Enable IOMMU for the integrated GPU.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">iommu=pt</span></code>: Enable IOMMU passthrough.</p></li>
</ul>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">root:~# </span>sed<span class="w"> </span>-i<span class="w"> </span><span class="s1">&#39;s/GRUB_CMDLINE_LINUX_DEFAULT=&quot;\(.*\)&quot;/GRUB_CMDLINE_LINUX_DEFAULT=&quot;\1 intel_iommu=on iommu=pt&quot;/&#39;</span><span class="w"> </span>/etc/default/grub
</pre></div>
</div>
</li>
<li><p>Update the GRUB configuration:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">root:~# </span>update-grub
</pre></div>
</div>
</li>
<li><p>Create a configuration file to bind the GPU to the VFIO driver:</p>
<p>a. Run the following command:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">root:~# </span>cat<span class="w"> </span>&gt;<span class="w"> </span>/etc/modprobe.d/vfio.conf
</pre></div>
</div>
<p>b. Copy and paste the following text:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">options</span> <span class="n">vfio</span><span class="o">-</span><span class="n">pci</span> <span class="n">ids</span><span class="o">=</span><span class="mi">10</span><span class="n">de</span><span class="p">:</span><span class="mi">2504</span><span class="p">,</span><span class="mi">10</span><span class="n">de</span><span class="p">:</span><span class="mi">228</span><span class="n">e</span>
<span class="n">softdep</span> <span class="n">nvidia</span> <span class="n">pre</span><span class="p">:</span> <span class="n">vfio</span><span class="o">-</span><span class="n">pci</span>
</pre></div>
</div>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>Replace <code class="docutils literal notranslate"><span class="pre">10de:2504,10de:228e</span></code> with the PCIe IDs of your GPU.</p>
</div>
<p>c. Run <code class="docutils literal notranslate"><span class="pre">CTRL</span> <span class="pre">+</span> <span class="pre">D</span></code> to exit.</p>
</li>
<li><p>Update the initial ramdisk:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">root:~# </span>update-initramfs<span class="w"> </span>-c<span class="w"> </span>-k<span class="w"> </span><span class="k">$(</span>uname<span class="w"> </span>-r<span class="k">)</span>
</pre></div>
</div>
</li>
<li><p>Reboot the system:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">root:~# </span>reboot
</pre></div>
</div>
</li>
</ol>
</section>
<section id="verify">
<h3>Verify<a class="headerlink" href="#verify" title="Link to this heading"></a></h3>
<p>Verify that the GPU is bound to the VFIO driver:</p>
<ol class="arabic">
<li><p>Check if the GPU is bound to the VFIO driver:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">root:~# </span>lspci<span class="w"> </span>-k<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-E<span class="w"> </span><span class="s2">&quot;vfio-pci|NVIDIA&quot;</span>
<span class="go">01:00.0 VGA compatible controller: NVIDIA Corporation GA106 [GeForce RTX 3060 Lite Hash Rate] (rev a1)</span>
<span class="go">    Kernel driver in use: vfio-pci</span>
<span class="go">01:00.1 Audio device: NVIDIA Corporation GA106 High Definition Audio Controller (rev a1)</span>
<span class="go">    Kernel driver in use: vfio-pci</span>
</pre></div>
</div>
</li>
</ol>
</section>
</section>
<section id="step-3-pass-the-gpu-to-the-vm">
<h2>Step 3: Pass the GPU to the VM<a class="headerlink" href="#step-3-pass-the-gpu-to-the-vm" title="Link to this heading"></a></h2>
<p>The final step is to pass the GPU to the VM. This step involves updating the VM XML configuration
file to include the GPU. The following instructions assume that you have already created a VM and
you have an NVIDIA GPU.</p>
<section id="id4">
<h3>What you’ll need<a class="headerlink" href="#id4" title="Link to this heading"></a></h3>
<p>To complete this step, you will need:</p>
<ul class="simple">
<li><p>A running VM.</p></li>
<li><p>A dedicated GPU that is not being used by the host.</p></li>
</ul>
</section>
<section id="id5">
<h3>Procedure<a class="headerlink" href="#id5" title="Link to this heading"></a></h3>
<p>Follow the steps below to pass the GPU to the VM.</p>
<ol class="arabic">
<li><p>Get the BusID of the GPU:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">root:~# </span>lspci<span class="w"> </span>-nn<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-i<span class="w"> </span>nvidia
<span class="go">01:00.0 VGA compatible controller [0300]: NVIDIA Corporation GA106 [GeForce RTX 3060 Lite Hash Rate] [10de:2504] (rev a1)</span>
<span class="go">01:00.1 Audio device [0403]: NVIDIA Corporation GA106 High Definition Audio Controller [10de:228e] (rev a1)</span>
</pre></div>
</div>
</li>
<li><p>Locate the PCI device address of the GPU:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">root:~# </span>virsh<span class="w"> </span>nodedev-list<span class="w"> </span>--tree
<span class="go">computer</span>
<span class="go">|</span>
<span class="go">+- net_lo_00_00_00_00_00_00</span>
<span class="go">+- net_vnet5_fe_54_00_2c_26_3f</span>
<span class="go">+- pci_0000_00_00_0</span>
<span class="go">+- pci_0000_00_01_0</span>
<span class="go">|   |</span>
<span class="go">|   +- pci_0000_01_00_0</span>
<span class="go">|   +- pci_0000_01_00_1</span>
<span class="go">...</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>In this example, the PCI device address of the GPU is <code class="docutils literal notranslate"><span class="pre">pci_0000_00_01_0</span></code>. This device has two
functions: <code class="docutils literal notranslate"><span class="pre">pci_0000_01_00_0</span></code> and <code class="docutils literal notranslate"><span class="pre">pci_0000_01_00_1</span></code>, which correspond to the VGA controller
and the Audio device, respectively.</p>
</div>
</li>
<li><p>Check the details of the PCI device:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">root:~# </span>virsh<span class="w"> </span>nodedev-dumpxml<span class="w"> </span>pci_0000_01_00_0
<span class="go">&lt;device&gt;</span>
<span class="go">&lt;name&gt;pci_0000_01_00_0&lt;/name&gt;</span>
<span class="go">&lt;path&gt;/sys/devices/pci0000:00/0000:00:01.0/0000:01:00.0&lt;/path&gt;</span>
<span class="go">&lt;parent&gt;pci_0000_00_01_0&lt;/parent&gt;</span>
<span class="go">&lt;driver&gt;</span>
<span class="go">    &lt;name&gt;vfio-pci&lt;/name&gt;</span>
<span class="go">&lt;/driver&gt;</span>
<span class="go">&lt;capability type=&#39;pci&#39;&gt;</span>
<span class="go">    &lt;class&gt;0x030000&lt;/class&gt;</span>
<span class="go">    &lt;domain&gt;0&lt;/domain&gt;</span>
<span class="go">    &lt;bus&gt;1&lt;/bus&gt;</span>
<span class="go">    &lt;slot&gt;0&lt;/slot&gt;</span>
<span class="go">    &lt;function&gt;0&lt;/function&gt;</span>
<span class="go">    &lt;product id=&#39;0x2504&#39;&gt;GA106 [GeForce RTX 3060 Lite Hash Rate]&lt;/product&gt;</span>
<span class="go">    &lt;vendor id=&#39;0x10de&#39;&gt;NVIDIA Corporation&lt;/vendor&gt;</span>
<span class="go">    &lt;iommuGroup number=&#39;19&#39;&gt;</span>
<span class="go">    &lt;address domain=&#39;0x0000&#39; bus=&#39;0x01&#39; slot=&#39;0x00&#39; function=&#39;0x0&#39;/&gt;</span>
<span class="go">    &lt;address domain=&#39;0x0000&#39; bus=&#39;0x01&#39; slot=&#39;0x00&#39; function=&#39;0x1&#39;/&gt;</span>
<span class="go">    &lt;/iommuGroup&gt;</span>
<span class="go">    &lt;pci-express&gt;</span>
<span class="go">    &lt;link validity=&#39;cap&#39; port=&#39;0&#39; speed=&#39;16&#39; width=&#39;16&#39;/&gt;</span>
<span class="go">    &lt;link validity=&#39;sta&#39; speed=&#39;16&#39; width=&#39;8&#39;/&gt;</span>
<span class="go">    &lt;/pci-express&gt;</span>
<span class="go">&lt;/capability&gt;</span>
<span class="go">&lt;/device&gt;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Note that the a GeForce RTX 3060 GPU has been found and that it’s address description is
<code class="docutils literal notranslate"><span class="pre">&lt;address</span> <span class="pre">domain='0x0000'</span> <span class="pre">bus='0x01'</span> <span class="pre">slot='0x00'</span> <span class="pre">function='0x0'/&gt;</span></code> for the VGA controller and
<code class="docutils literal notranslate"><span class="pre">&lt;address</span> <span class="pre">domain='0x0000'</span> <span class="pre">bus='0x01'</span> <span class="pre">slot='0x00'</span> <span class="pre">function='0x1'/&gt;</span></code> for the Audio device.</p>
</div>
</li>
<li><p>Update the VM XML configuration file to include the GPU:</p>
<p>a. Edit the VM XML configuration file:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">root:~# </span>virsh<span class="w"> </span>edit<span class="w"> </span>&lt;definition-name&gt;
</pre></div>
</div>
<p>b. Add the following lines to the XML configuration file, under the <code class="docutils literal notranslate"><span class="pre">&lt;devices&gt;</span></code> section:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;hostdev</span><span class="w"> </span><span class="na">mode=</span><span class="s">&#39;subsystem&#39;</span><span class="w"> </span><span class="na">type=</span><span class="s">&#39;pci&#39;</span><span class="w"> </span><span class="na">managed=</span><span class="s">&#39;yes&#39;</span><span class="nt">&gt;</span>
<span class="w">  </span><span class="nt">&lt;source&gt;</span>
<span class="w">    </span><span class="nt">&lt;address</span><span class="w"> </span><span class="na">domain=</span><span class="s">&#39;0x0000&#39;</span><span class="w"> </span><span class="na">bus=</span><span class="s">&#39;0x01&#39;</span><span class="w"> </span><span class="na">slot=</span><span class="s">&#39;0x00&#39;</span><span class="w"> </span><span class="na">function=</span><span class="s">&#39;0x0&#39;</span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;/source&gt;</span>
<span class="w">    </span><span class="nt">&lt;address</span><span class="w"> </span><span class="na">type=</span><span class="s">&#39;pci&#39;</span><span class="w"> </span><span class="na">domain=</span><span class="s">&#39;0x0000&#39;</span><span class="w"> </span><span class="na">bus=</span><span class="s">&#39;0x00&#39;</span><span class="w"> </span><span class="na">slot=</span><span class="s">&#39;0x05&#39;</span><span class="w"> </span><span class="na">function=</span><span class="s">&#39;0x0&#39;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/hostdev&gt;</span>
<span class="nt">&lt;hostdev</span><span class="w"> </span><span class="na">mode=</span><span class="s">&#39;subsystem&#39;</span><span class="w"> </span><span class="na">type=</span><span class="s">&#39;pci&#39;</span><span class="w"> </span><span class="na">managed=</span><span class="s">&#39;yes&#39;</span><span class="nt">&gt;</span>
<span class="w">  </span><span class="nt">&lt;source&gt;</span>
<span class="w">    </span><span class="nt">&lt;address</span><span class="w"> </span><span class="na">domain=</span><span class="s">&#39;0x0000&#39;</span><span class="w"> </span><span class="na">bus=</span><span class="s">&#39;0x01&#39;</span><span class="w"> </span><span class="na">slot=</span><span class="s">&#39;0x00&#39;</span><span class="w"> </span><span class="na">function=</span><span class="s">&#39;0x1&#39;</span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;/source&gt;</span>
<span class="w">    </span><span class="nt">&lt;address</span><span class="w"> </span><span class="na">type=</span><span class="s">&#39;pci&#39;</span><span class="w"> </span><span class="na">domain=</span><span class="s">&#39;0x0000&#39;</span><span class="w"> </span><span class="na">bus=</span><span class="s">&#39;0x00&#39;</span><span class="w"> </span><span class="na">slot=</span><span class="s">&#39;0x06&#39;</span><span class="w"> </span><span class="na">function=</span><span class="s">&#39;0x0&#39;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/hostdev&gt;</span>
</pre></div>
</div>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>Replace the <code class="docutils literal notranslate"><span class="pre">address</span></code> values with the values from the previous step.</p>
</div>
<p>c. Save the changes and exit the editor.</p>
</li>
<li><p>Reboot the VM:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">root:~# </span>virsh<span class="w"> </span>reboot<span class="w"> </span>&lt;definition-name&gt;
</pre></div>
</div>
</li>
</ol>
</section>
<section id="id6">
<h3>Verify<a class="headerlink" href="#id6" title="Link to this heading"></a></h3>
<p>Verify that the GPU is passed to the VM. SSH to the VM and check if the GPU is detected:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">user:~$ </span>lspci<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-i<span class="w"> </span>nvidia
<span class="go">00:05.0 VGA compatible controller: NVIDIA Corporation GA106 [GeForce RTX 3060 Lite Hash Rate] (rev a1)</span>
<span class="go">00:06.0 Audio device: NVIDIA Corporation GA106 High Definition Audio Controller (rev a1)</span>
</pre></div>
</div>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="rename-vm.html" class="btn btn-neutral float-left" title="Rename a VM" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, Dimitris Poulopoulos.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>